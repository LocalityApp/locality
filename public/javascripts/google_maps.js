var map;  
var nightspots;
var markers = [];
var locations = {
    'attractions': null,
    'education': null,
    'nightlife': null,
    'parks': null,
    'services': null, 
    'transit': null,
    'scoring': []
};

var polygon = {
    'attractions': '{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-104.98747008376239,39.747509227424544],[-104.98750993272155,39.7400899942521],[-104.98814002471488,39.740089916011044],[-104.98893997345866,39.74059021335246],[-104.98974002922172,39.74019000335825],[-104.9904400012346,39.74008999515147],[-104.99811002924093,39.740183801633606],[-104.99980334110614,39.74218346395085],[-105.00044016722279,39.74358996673247],[-105.00051240757213,39.745487184553625],[-105.00034931945765,39.7456105444338],[-104.99977980112232,39.74609517125586],[-104.99928463326592,39.74647526195291],[-104.99875282147957,39.74686288389039],[-104.9980317746844,39.747403668986735],[-104.9974669096017,39.747837497345216],[-104.99684847509418,39.74832734646],[-104.99633614575168,39.74873315187993],[-104.99567320363145,39.749258254549275],[-104.99505909631455,39.74971804333437],[-104.99437680203951,39.75019817634265],[-104.99381870089893,39.75062301705762],[-104.99312547967867,39.75119286839973],[-104.99251740394526,39.75166444704111],[-104.99210984286091,39.75197011785448],[-104.9919192261108,39.75211308041689],[-104.99170999999996,39.752269999999996],[-104.99140433814058,39.75204514529892],[-104.99106913514002,39.751798559183484],[-104.9906032590203,39.75143033893275],[-104.99024315176197,39.751126634016245],[-104.98982062517075,39.75078151291805],[-104.98929628791242,39.75037038484042],[-104.98889550081122,39.75006873654759],[-104.98832080374814,39.74964901397338],[-104.98806385549027,39.74945952258547],[-104.98749550564104,39.749038522697006],[-104.98734999999999,39.74891999999993],[-104.98738796561962,39.74762022878305],[-104.98739151638365,39.747514880896546],[-104.98747008376239,39.747509227424544]]]},"properties":{"State":"CO","County":"Denver","City":"Denver","Name":"Central Business District","RegionID":"268632"}}',
    'education': '{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-104.98747008376239,39.747509227424544],[-104.98750993272155,39.7400899942521],[-104.98814002471488,39.740089916011044],[-104.98893997345866,39.74059021335246],[-104.98974002922172,39.74019000335825],[-104.9904400012346,39.74008999515147],[-104.99811002924093,39.740183801633606],[-104.99980334110614,39.74218346395085],[-105.00044016722279,39.74358996673247],[-105.00051240757213,39.745487184553625],[-105.00034931945765,39.7456105444338],[-104.99977980112232,39.74609517125586],[-104.99928463326592,39.74647526195291],[-104.99875282147957,39.74686288389039],[-104.9980317746844,39.747403668986735],[-104.9974669096017,39.747837497345216],[-104.99684847509418,39.74832734646],[-104.99633614575168,39.74873315187993],[-104.99567320363145,39.749258254549275],[-104.99505909631455,39.74971804333437],[-104.99437680203951,39.75019817634265],[-104.99381870089893,39.75062301705762],[-104.99312547967867,39.75119286839973],[-104.99251740394526,39.75166444704111],[-104.99210984286091,39.75197011785448],[-104.9919192261108,39.75211308041689],[-104.99170999999996,39.752269999999996],[-104.99140433814058,39.75204514529892],[-104.99106913514002,39.751798559183484],[-104.9906032590203,39.75143033893275],[-104.99024315176197,39.751126634016245],[-104.98982062517075,39.75078151291805],[-104.98929628791242,39.75037038484042],[-104.98889550081122,39.75006873654759],[-104.98832080374814,39.74964901397338],[-104.98806385549027,39.74945952258547],[-104.98749550564104,39.749038522697006],[-104.98734999999999,39.74891999999993],[-104.98738796561962,39.74762022878305],[-104.98739151638365,39.747514880896546],[-104.98747008376239,39.747509227424544]]]},"properties":{"State":"CO","County":"Denver","City":"Denver","Name":"Central Business District","RegionID":"268632"}}',
    'nightlife': '{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-104.98747008376239,39.747509227424544],[-104.98750993272155,39.7400899942521],[-104.98814002471488,39.740089916011044],[-104.98893997345866,39.74059021335246],[-104.98974002922172,39.74019000335825],[-104.9904400012346,39.74008999515147],[-104.99811002924093,39.740183801633606],[-104.99980334110614,39.74218346395085],[-105.00044016722279,39.74358996673247],[-105.00051240757213,39.745487184553625],[-105.00034931945765,39.7456105444338],[-104.99977980112232,39.74609517125586],[-104.99928463326592,39.74647526195291],[-104.99875282147957,39.74686288389039],[-104.9980317746844,39.747403668986735],[-104.9974669096017,39.747837497345216],[-104.99684847509418,39.74832734646],[-104.99633614575168,39.74873315187993],[-104.99567320363145,39.749258254549275],[-104.99505909631455,39.74971804333437],[-104.99437680203951,39.75019817634265],[-104.99381870089893,39.75062301705762],[-104.99312547967867,39.75119286839973],[-104.99251740394526,39.75166444704111],[-104.99210984286091,39.75197011785448],[-104.9919192261108,39.75211308041689],[-104.99170999999996,39.752269999999996],[-104.99140433814058,39.75204514529892],[-104.99106913514002,39.751798559183484],[-104.9906032590203,39.75143033893275],[-104.99024315176197,39.751126634016245],[-104.98982062517075,39.75078151291805],[-104.98929628791242,39.75037038484042],[-104.98889550081122,39.75006873654759],[-104.98832080374814,39.74964901397338],[-104.98806385549027,39.74945952258547],[-104.98749550564104,39.749038522697006],[-104.98734999999999,39.74891999999993],[-104.98738796561962,39.74762022878305],[-104.98739151638365,39.747514880896546],[-104.98747008376239,39.747509227424544]]]},"properties":{"State":"CO","County":"Denver","City":"Denver","Name":"Central Business District","RegionID":"268632"}}',
    'parks': '{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-104.94072986994509,39.72559010286595],[-104.94070001964828,39.71462999604704],[-104.94071339616417,39.71143563657445],[-104.94077035562425,39.71143787498684],[-104.94726173487688,39.71154867505836],[-104.94796305988436,39.711554471132914],[-104.94799227875924,39.71157919479621],[-104.94914024869941,39.71253176559773],[-104.95031264353165,39.713484336398906],[-104.95097467370739,39.713910728715646],[-104.9517537121798,39.714412482307836],[-104.95231548470367,39.71473000590814],[-104.9535935887906,39.71521191045978],[-104.9539763773828,39.71534062821685],[-104.95426947609094,39.71541390289384],[-104.95485567350707,39.71560930203249],[-104.9553930211387,39.715731426494145],[-104.95607691812423,39.71578027627899],[-104.95663869064802,39.71582912606365],[-104.95739586231055,39.71582912606365],[-104.95800648461918,39.71578027627899],[-104.95927866918655,39.715620416699814],[-104.95932998180355,39.71829003435866],[-104.9595200004545,39.72096999422095],[-104.95941999494546,39.72248000806869],[-104.95942400324938,39.72253867532961],[-104.95940999999989,39.72255000000014],[-104.95940589232853,39.72319901209621],[-104.95940427468801,39.723454599286114],[-104.95940179603447,39.72384622655753],[-104.95940000000003,39.72413000000013],[-104.9593980143825,39.72420346784341],[-104.95939384946654,39.72435756973759],[-104.95940031077171,39.72456186463077],[-104.95943713810524,39.72478282863217],[-104.95948598671573,39.724919565461235],[-104.95958844983728,39.7250558634885],[-104.9597356385092,39.725176884649414],[-104.95989343858692,39.725280063152226],[-104.9599798528956,39.725345882316475],[-104.96013999999998,39.725600000000085],[-104.96014008591933,39.72560005014823],[-104.94072986994509,39.72559010286595]]]},"properties":{"State":"CO","County":"Denver","City":"Denver","Name":"Cherry Creek","RegionID":"268635"}}',
    'services': '{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-105.0005124079999,39.74548718500006],[-105.00051708199993,39.745609940000065],[-105.00114005799992,39.747889942000086],[-105.00167990799991,39.74872008300008],[-105.00437190899993,39.75074949400005],[-105.00458584099994,39.75120180300007],[-105.00523996599992,39.751489968000044],[-105.00565678399994,39.75160607000004],[-105.00630002799994,39.752139939000074],[-105.00806873599993,39.75468633200006],[-105.00803374499992,39.75474975700007],[-105.00800216999994,39.754885433000084],[-105.0077748249999,39.755136709000055],[-105.00755944499991,39.75539995100007],[-105.00723637599992,39.75574695100005],[-105.0068774099999,39.756201641000075],[-105.00663809899993,39.756452918000036],[-105.00651844399994,39.75662043500006],[-105.0063868229999,39.75675205600004],[-105.00624323699992,39.75694350400005],[-105.00595606399992,39.75730247000007],[-105.00584837399992,39.75750588400007],[-105.00572871899993,39.75774519500004],[-105.00550137399995,39.75812809200005],[-105.00530992499995,39.75831954100005],[-105.00508257999991,39.75863064400005],[-105.0048911319999,39.75875030000009],[-105.00473557999993,39.75881012700006],[-105.00452019999994,39.75902550700005],[-105.00431678599995,39.75933661100004],[-105.0041014059999,39.759647715000085],[-105.0038979919999,39.75986309400008],[-105.0037065439999,39.76003061200004],[-105.0035150949999,39.76011437000005],[-105.00325185399993,39.76035368100008],[-105.00302450899994,39.760473336000075],[-105.00301385199992,39.76047866500005],[-105.00294162299991,39.76037210800007],[-105.00283588399992,39.76031522400007],[-105.00264221799995,39.76021301900005],[-105.00247893799991,39.760108520000074],[-105.00229579299992,39.75999130800005],[-105.00214365799991,39.75989394100009],[-105.00195615199993,39.75977393800008],[-105.00169999999991,39.759610000000066],[-105.0014833969999,39.75950310500008],[-105.00119577699991,39.75936116300005],[-105.00093561699993,39.759232772000075],[-105.00079956899992,39.759161161000065],[-105.00069199299992,39.75910438500006],[-105.00053661499993,39.759023307000064],[-105.00045658599993,39.75897661600004],[-105.00038353299993,39.75893676700008],[-105.00019713299992,39.75884856600004],[-105.00001855599993,39.75874513400004],[-104.99983603499993,39.75863459400006],[-104.9995766809999,39.758461468000064],[-104.9994381009999,39.75835286200004],[-104.99926497899992,39.758214905000045],[-104.99905644899991,39.75804873300007],[-104.9988758309999,39.75790723000006],[-104.99874155299995,39.75780760400005],[-104.99860999999993,39.75771000000009],[-104.99847665099992,39.757617767000056],[-104.99830872699994,39.75750240000008],[-104.9981456939999,39.757372125000074],[-104.99795797299993,39.757203176000075],[-104.99779760899992,39.75705884800004],[-104.99760172499992,39.75689671100008],[-104.99736372699994,39.75670666800005],[-104.9972499999999,39.75661000000008],[-104.99703087299991,39.75642333600007],[-104.9967070859999,39.75618348200004],[-104.9964429819999,39.75597148600008],[-104.99616864699993,39.755750711000076],[-104.9959166399999,39.75555831400004],[-104.99573703899995,39.755427517000044],[-104.99535345999993,39.75514817200008],[-104.99508358499992,39.75495572300008],[-104.99465758499991,39.754647436000084],[-104.9942999999999,39.75437000000005],[-104.99379344499994,39.753923039000085],[-104.99340031299994,39.75358096000008],[-104.99285512699993,39.75315259900009],[-104.99266434899994,39.75300270300005],[-104.99229878099993,39.75272139900005],[-104.99200879599994,39.75249907700004],[-104.9917099999999,39.75227000000007],[-104.99191922599994,39.75211308000007],[-104.99210984299992,39.75197011800009],[-104.9925174039999,39.75166444700005],[-104.99312547999995,39.75119286800009],[-104.9938187009999,39.750623017000066],[-104.99437680199992,39.75019817600008],[-104.99505909599992,39.74971804300009],[-104.9956732039999,39.749258255000086],[-104.99633614599992,39.74873315200006],[-104.99684847499992,39.74832734600005],[-104.9974669099999,39.747837497000035],[-104.9980317749999,39.74740366900005],[-104.99875282099993,39.74686288400005],[-104.99928463299995,39.74647526200005],[-104.99977980099993,39.746095171000036],[-105.0003493189999,39.745610544000044],[-105.0005124079999,39.74548718500006]]]},"properties":{"State":"CO","County":"Denver","City":"Denver","Name":"Union Station","RegionID":"268759"}}', 
    'transit': '{"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[-105.0005124079999,39.74548718500006],[-105.00051708199993,39.745609940000065],[-105.00114005799992,39.747889942000086],[-105.00167990799991,39.74872008300008],[-105.00437190899993,39.75074949400005],[-105.00458584099994,39.75120180300007],[-105.00523996599992,39.751489968000044],[-105.00565678399994,39.75160607000004],[-105.00630002799994,39.752139939000074],[-105.00806873599993,39.75468633200006],[-105.00803374499992,39.75474975700007],[-105.00800216999994,39.754885433000084],[-105.0077748249999,39.755136709000055],[-105.00755944499991,39.75539995100007],[-105.00723637599992,39.75574695100005],[-105.0068774099999,39.756201641000075],[-105.00663809899993,39.756452918000036],[-105.00651844399994,39.75662043500006],[-105.0063868229999,39.75675205600004],[-105.00624323699992,39.75694350400005],[-105.00595606399992,39.75730247000007],[-105.00584837399992,39.75750588400007],[-105.00572871899993,39.75774519500004],[-105.00550137399995,39.75812809200005],[-105.00530992499995,39.75831954100005],[-105.00508257999991,39.75863064400005],[-105.0048911319999,39.75875030000009],[-105.00473557999993,39.75881012700006],[-105.00452019999994,39.75902550700005],[-105.00431678599995,39.75933661100004],[-105.0041014059999,39.759647715000085],[-105.0038979919999,39.75986309400008],[-105.0037065439999,39.76003061200004],[-105.0035150949999,39.76011437000005],[-105.00325185399993,39.76035368100008],[-105.00302450899994,39.760473336000075],[-105.00301385199992,39.76047866500005],[-105.00294162299991,39.76037210800007],[-105.00283588399992,39.76031522400007],[-105.00264221799995,39.76021301900005],[-105.00247893799991,39.760108520000074],[-105.00229579299992,39.75999130800005],[-105.00214365799991,39.75989394100009],[-105.00195615199993,39.75977393800008],[-105.00169999999991,39.759610000000066],[-105.0014833969999,39.75950310500008],[-105.00119577699991,39.75936116300005],[-105.00093561699993,39.759232772000075],[-105.00079956899992,39.759161161000065],[-105.00069199299992,39.75910438500006],[-105.00053661499993,39.759023307000064],[-105.00045658599993,39.75897661600004],[-105.00038353299993,39.75893676700008],[-105.00019713299992,39.75884856600004],[-105.00001855599993,39.75874513400004],[-104.99983603499993,39.75863459400006],[-104.9995766809999,39.758461468000064],[-104.9994381009999,39.75835286200004],[-104.99926497899992,39.758214905000045],[-104.99905644899991,39.75804873300007],[-104.9988758309999,39.75790723000006],[-104.99874155299995,39.75780760400005],[-104.99860999999993,39.75771000000009],[-104.99847665099992,39.757617767000056],[-104.99830872699994,39.75750240000008],[-104.9981456939999,39.757372125000074],[-104.99795797299993,39.757203176000075],[-104.99779760899992,39.75705884800004],[-104.99760172499992,39.75689671100008],[-104.99736372699994,39.75670666800005],[-104.9972499999999,39.75661000000008],[-104.99703087299991,39.75642333600007],[-104.9967070859999,39.75618348200004],[-104.9964429819999,39.75597148600008],[-104.99616864699993,39.755750711000076],[-104.9959166399999,39.75555831400004],[-104.99573703899995,39.755427517000044],[-104.99535345999993,39.75514817200008],[-104.99508358499992,39.75495572300008],[-104.99465758499991,39.754647436000084],[-104.9942999999999,39.75437000000005],[-104.99379344499994,39.753923039000085],[-104.99340031299994,39.75358096000008],[-104.99285512699993,39.75315259900009],[-104.99266434899994,39.75300270300005],[-104.99229878099993,39.75272139900005],[-104.99200879599994,39.75249907700004],[-104.9917099999999,39.75227000000007],[-104.99191922599994,39.75211308000007],[-104.99210984299992,39.75197011800009],[-104.9925174039999,39.75166444700005],[-104.99312547999995,39.75119286800009],[-104.9938187009999,39.750623017000066],[-104.99437680199992,39.75019817600008],[-104.99505909599992,39.74971804300009],[-104.9956732039999,39.749258255000086],[-104.99633614599992,39.74873315200006],[-104.99684847499992,39.74832734600005],[-104.9974669099999,39.747837497000035],[-104.9980317749999,39.74740366900005],[-104.99875282099993,39.74686288400005],[-104.99928463299995,39.74647526200005],[-104.99977980099993,39.746095171000036],[-105.0003493189999,39.745610544000044],[-105.0005124079999,39.74548718500006]]]},"properties":{"State":"CO","County":"Denver","City":"Denver","Name":"Union Station","RegionID":"268759"}}',
};
var customMarkers = {
    'attractions': {
        url: 'images/map-icons/attractions.png',
        // This marker is 20 pixels wide by 32 pixels high.
        size: new google.maps.Size(20, 27),
        // The origin for this image is (0, 0).
        origin: new google.maps.Point(0, 0),
        // The anchor for this image is the base of the flagpole at (0, 32).
        anchor: new google.maps.Point(0, 32)
    },
    'education': {
        url: 'images/map-icons/school.png',
        // This marker is 20 pixels wide by 32 pixels high.
        size: new google.maps.Size(25, 35),
        // The origin for this image is (0, 0).
        origin: new google.maps.Point(0, 0),
        // The anchor for this image is the base of the flagpole at (0, 32).
        anchor: new google.maps.Point(0, 32)
    },
    'nightlife': {
        url: 'images/map-icons/restaurant.png',
        // This marker is 20 pixels wide by 32 pixels high.
        size: new google.maps.Size(25, 36),
        // The origin for this image is (0, 0).
        origin: new google.maps.Point(0, 0),
        // The anchor for this image is the base of the flagpole at (0, 32).
        anchor: new google.maps.Point(0, 32)
    },
    'parks': {
        url: 'images/map-icons/parks.png',
        // This marker is 20 pixels wide by 32 pixels high.
        size: new google.maps.Size(26, 35),
        // The origin for this image is (0, 0).
        origin: new google.maps.Point(0, 0),
        // The anchor for this image is the base of the flagpole at (0, 32).
        anchor: new google.maps.Point(0, 32)
    },
    'services': {
        url: 'images/map-icons/services.png',
        // This marker is 20 pixels wide by 32 pixels high.
        size: new google.maps.Size(25, 34),
        // The origin for this image is (0, 0).
        origin: new google.maps.Point(0, 0),
        // The anchor for this image is the base of the flagpole at (0, 32).
        anchor: new google.maps.Point(0, 32)
    }, 
    'transit': {
        url: 'images/map-icons/transit.png',
        // This marker is 20 pixels wide by 32 pixels high.
        size: new google.maps.Size(25, 36),
        // The origin for this image is (0, 0).
        origin: new google.maps.Point(0, 0),
        // The anchor for this image is the base of the flagpole at (0, 32).
        anchor: new google.maps.Point(0, 32)
    }
};
var userLocation = {
    lat:'',
    lng:''
};

var userImg = {
    url: 'images/user.png',
    // This marker is 20 pixels wide by 32 pixels high.
    size: new google.maps.Size(20, 32),
    // The origin for this image is (0, 0).
    origin: new google.maps.Point(0, 0),
    // The anchor for this image is the base of the flagpole at (0, 32).
    anchor: new google.maps.Point(0, 32)
  };

function markerWithContent(lat, lng, html, title){
    let position = {lat: lat, lng: lng};
    var contentString = html;

    var infowindow = new google.maps.InfoWindow({
        content: contentString
    });

    var marker = new google.maps.Marker({
        position: position,
        map: map,
        title: title
    });
    marker.addListener('click', function() {
        infowindow.open(map, marker);
    });
    return marker;
}
const userLocality = ()=>{
    navigator.geolocation.getCurrentPosition(function(position){  
        userLocality.lat = position.coords.latitude;
        userLocality.lng = position.coords.longitude;
        alert('Lat: ' + position.coords.latitude + ' ' +  
              'Lon: ' + position.coords.longitude);  
    });
};

const userMarker = userLocality =>{
    var usersPosition = new google.maps.Marker({
        map: map,
        draggable: true,
        animation: google.maps.Animation.DROP,
        position: {lat: 59.327, lng: 18.067},
        icon: userImg
    }, setTimeout(usersPosition =>{
        usersPosition.animation = google.maps.Animation.BOUNCE;
    }, 500));

};

function drop(context1, context2, context3, context4) {
    clearMarkers();
    // Add a title to each of these methods
    for (var i = 0; i < locations[context1].dataPoints.length; i++) {
      let spot = locations[context1].dataPoints[i].geometry.coordinates;
      addMarkerWithTimeout({lat:spot[1], lng:spot[0]}, (i * 60), context1);
    }
    for (var j = 0; j < locations[context2].dataPoints.length; j++) {
        let spot = locations[context2].dataPoints[j].geometry.coordinates;
        addMarkerWithTimeout({lat:spot[1], lng:spot[0]}, ((i*60) + (j * 40)), context2);
    }
    for (var k = 0; k < locations[context3].dataPoints.length; k++) {
        let spot = locations[context3].dataPoints[k].geometry.coordinates;
        addMarkerWithTimeout({lat:spot[1], lng:spot[0]}, ((i*60) + (j * 40) + (k * 20)), context3);
        if(k == (locations[context3].dataPoints.length-3)){
            loadGeoJsonString(polygon[context1]); 
        }
      }
    for (var l = 0; l < locations[context4].dataPoints.length; l++) {
        let spot = locations[context4].dataPoints[i].geometry.coordinates;
        addMarkerWithTimeout({lat:spot[1], lng:spot[0]}, ((i*60) + (j * 40) + (k * 20) + (l*10)), context4);
    }
}

function addMarkerWithTimeout(position, timeout, context, title='') {
    window.setTimeout(function() {
        markers.push(new google.maps.Marker({
            position: position,
            map: map,
            animation: google.maps.Animation.DROP,
            icon: customMarkers[context]
        }));
    }, timeout);
}

function clearMarkers() {
    for (var i = 0; i < markers.length; i++) {
      markers[i].setMap(null);
    }
    markers = [];
}
var userInputLocation;
var cityCenter;

cityCenter = {lat: 39.7392,lng: -104.9903};

// initialize function
function initialize() {

    // center point for search on denver
    var mapOptions = {
        zoom: 14, 
        center: cityCenter
    };

    // instance of Maps service center + zoom to userInputLocation
    map = new google.maps.Map(document.getElementById('map'), mapOptions);

}

function loadGeoJsonString(geoString) {
    window.setTimeout(function() {
        var geojson = JSON.parse(geoString);
        map.data.addGeoJson(geojson);
        zoom(map);
    }, 20000);
    
  }